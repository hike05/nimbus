# Logrotate configuration for Stealth VPN Server
# Install to /etc/logrotate.d/stealth-vpn

# Xray logs
/data/stealth-vpn/logs/xray/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        docker exec stealth-xray pkill -HUP xray 2>/dev/null || true
    endscript
}

# Trojan logs
/data/stealth-vpn/logs/trojan/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        docker exec stealth-trojan pkill -HUP trojan-go 2>/dev/null || true
    endscript
}

# Sing-box logs
/data/stealth-vpn/logs/singbox/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        docker exec stealth-singbox pkill -HUP sing-box 2>/dev/null || true
    endscript
}

# WireGuard logs
/data/stealth-vpn/logs/wireguard/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}

# Caddy logs
/data/stealth-vpn/logs/caddy/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        docker exec stealth-caddy caddy reload --config /etc/caddy/Caddyfile 2>/dev/null || true
    endscript
}

# Admin panel logs
/data/stealth-vpn/logs/admin/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}

# System logs
/data/stealth-vpn/logs/system/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}

# Health check logs (keep longer)
/data/stealth-vpn/logs/health.json {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}

# Alert logs (keep longer)
/data/stealth-vpn/logs/alerts.json {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}
