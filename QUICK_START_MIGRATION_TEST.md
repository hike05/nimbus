# Quick Start: Migration Test

–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ vov.sneakernet.top

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
./scripts/verify-migration-ready.sh
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ ‚úì

## –®–∞–≥ 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞
./scripts/deploy-migration-to-server.sh root@vov.sneakernet.top:/root/stealth-vpn-server
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**
- –°–∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –£—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

## –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@vov.sneakernet.top
cd /root/stealth-vpn-server
```

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
cat data/stealth-vpn/configs/users.json | python3 -m json.tool
```

## –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä—É—á–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
tar -czf ~/backup-before-migration-$(date +%Y%m%d_%H%M%S).tar.gz \
    docker-compose.yml \
    config/Caddyfile \
    .env \
    data/stealth-vpn/configs/ \
    data/caddy/certificates/

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –±—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω
ls -lh ~/backup-before-migration-*
```

## –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
./scripts/migrate-to-new-version.sh
```

**–ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å:**
1. –°–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ - –≤–≤–µ–¥–∏—Ç–µ `y`
2. –°–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø
3. –û—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–µ—Ä–≤–∏—Å—ã
4. –û–±–Ω–æ–≤—è—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. –ü–µ—Ä–µ—Å–æ–±–µ—Ä—É—Ç—Å—è Docker –æ–±—Ä–∞–∑—ã
6. –ó–∞–ø—É—Å—Ç—è—Ç—Å—è —Å–µ—Ä–≤–∏—Å—ã
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—Å—è —Å—Ç–∞—Ç—É—Å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç

## –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "Up (healthy)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs --tail=50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
curl -k https://vov.sneakernet.top/admin

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
ls -la data/caddy/certificates/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
cat data/stealth-vpn/configs/users.json
```

## –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ VPN —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose logs xray --tail=20
docker compose logs trojan --tail=20
docker compose logs singbox --tail=20
docker compose logs wireguard --tail=20
```

**–ù–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –º–∞—à–∏–Ω–µ:** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π VPN

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç

```bash
./scripts/rollback-migration.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
cp docker-compose.yml.pre-migration docker-compose.yml
cp config/Caddyfile.pre-migration config/Caddyfile

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä—É—á–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞

```bash
cd ~
tar -xzf backup-before-migration-*.tar.gz -C /root/stealth-vpn-server/
cd /root/stealth-vpn-server
docker compose up -d
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ **–£—Å–ø–µ—à–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è, –µ—Å–ª–∏:**
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Up (healthy)"
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞
- VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ù–∞–π—Ç–∏ –ª–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–∏
ls -lt migration_*.log | head -1

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥
cat migration_*.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep ERROR migration_*.log

# –ü–æ–∏—Å–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
grep WARNING migration_*.log
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
./scripts/health-check.sh
```

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–æ:
- ‚úÖ docker-compose.yml - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ Caddyfile - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- ‚úÖ Docker –æ–±—Ä–∞–∑—ã - –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VPN
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

### –°–æ–∑–¥–∞–Ω–æ:
- üì¶ –ë—ç–∫–∞–ø: `data/stealth-vpn/backups/backup_TIMESTAMP.tar.gz`
- üì¶ docker-compose.yml.pre-migration
- üì¶ config/Caddyfile.pre-migration
- üìù migration_TIMESTAMP.log

## –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü–æ–¥–æ–∂–¥–∏—Ç–µ 24-48 —á–∞—Å–æ–≤**, –∑–∞—Ç–µ–º:

```bash
# –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
rm docker-compose.yml.pre-migration
rm config/Caddyfile.pre-migration

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö Docker –æ–±—Ä–∞–∑–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker image prune -a

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart caddy

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f admin

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ docker-compose
docker compose config

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏](docs/MIGRATION_GUIDE.md)
- üìñ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤](docs/MIGRATION_SCRIPTS.md)
- üìñ [–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](docs/TESTING_MIGRATION.md)
- üìã [–ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](MIGRATION_TEST_CHECKLIST.md)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–∏: `cat migration_*.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤: `docker compose logs`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–∫–∞—Ç: `./scripts/rollback-migration.sh`
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤—ã—à–µ

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?** –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ –®–∞–≥–∞ 1! üöÄ
